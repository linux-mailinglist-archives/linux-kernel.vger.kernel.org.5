Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 89F8B7E28BC
	for <lists+linux-kernel@lfdr.de>; Mon,  6 Nov 2023 16:33:22 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S232083AbjKFPdW (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Mon, 6 Nov 2023 10:33:22 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:41726 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S231277AbjKFPdU (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Mon, 6 Nov 2023 10:33:20 -0500
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 01ABCB8
        for <linux-kernel@vger.kernel.org>; Mon,  6 Nov 2023 07:33:18 -0800 (PST)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 95FE8C433C7;
        Mon,  6 Nov 2023 15:33:17 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1699284797;
        bh=xV7m5Axz6doc1+4iuhW6bs3XG18ZDG1RNL3LtMPk/bA=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=QSe+LhMhvFLDhezunvYjS91vcxuGdkNV3dRzxEHBsN2hfo6RPH/Pt2YTxiRrRmcAD
         OvgnVk5QNtmf4artyOZ1+svaV6jGvSQ6y6y/mlMVdK1eZ/b3E9RjHeYg6VOHt/QRES
         4qxEJlQ9pZnV6Bymj2bqCcqmMjYc9+47Z0Q7Bm5Xbj+pa39mwdQKMiI3MCY3N//fk2
         2AADPaFJc9/oKRhknESCqAhP7DjE7Jxn8eN/6n202w/G9Ioz/GqWmejgS4EMhpmbsJ
         bWJIxJ4lWSKBEs35tUSSjf48SDSbjVWyPJQozNEgzLGwXZFinq+fI8tQ1vHWUbliDV
         NbIa5ZTv5f+/A==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1r01bG-00Ao8C-Rb;
        Mon, 06 Nov 2023 15:33:15 +0000
Date:   Mon, 06 Nov 2023 15:33:14 +0000
Message-ID: <86edh228xx.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Kunkun Jiang <jiangkunkun@huawei.com>
Cc:     Oliver Upton <oliver.upton@linux.dev>,
        James Morse <james.morse@arm.com>,
        Suzuki K Poulose <suzuki.poulose@arm.com>,
        Zenghui Yu <yuzenghui@huawei.com>,
        Catalin Marinas <catalin.marinas@arm.com>,
        Will Deacon <will@kernel.org>, Gavin Shan <gshan@redhat.com>,
        Jean-Philippe Brucker <jean-philippe@linaro.org>,
        "open list:IRQCHIP DRIVERS" <linux-kernel@vger.kernel.org>,
        <linux-arm-kernel@lists.infradead.org>, <kvmarm@lists.linux.dev>,
        <wanghaibin.wang@huawei.com>
Subject: Re: [RFC PATCH] KVM: arm/arm64: GICv4: Support shared VLPI
In-Reply-To: <1fb8353e-e9c4-2570-c2ca-ec537c18ac4d@huawei.com>
References: <20231102143507.840-1-jiangkunkun@huawei.com>
        <87msvt6cc7.wl-maz@kernel.org>
        <1fb8353e-e9c4-2570-c2ca-ec537c18ac4d@huawei.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/29.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: jiangkunkun@huawei.com, oliver.upton@linux.dev, james.morse@arm.com, suzuki.poulose@arm.com, yuzenghui@huawei.com, catalin.marinas@arm.com, will@kernel.org, gshan@redhat.com, jean-philippe@linaro.org, linux-kernel@vger.kernel.org, linux-arm-kernel@lists.infradead.org, kvmarm@lists.linux.dev, wanghaibin.wang@huawei.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,
        RCVD_IN_DNSWL_BLOCKED,SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE
        autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Mon, 06 Nov 2023 14:59:01 +0000,
Kunkun Jiang <jiangkunkun@huawei.com> wrote:
> 
> The virtio-pci driver write entry1-6
> massage.data in the msix-table and trap to QEMU for processing. The
> massage.data is as follow:
> > entry-0 0
> > entry-1 1
> > entry-2 1
> > entry-3 1
> > entry-4 1
> > entry-5 1
> > entry-6 1

Urgh... is vp_modern_queue_vector() used in your configuration? This
is ... terrible.

I wonder if PCIe actually allows this sort of thing.

In any case, this sort of behaviour breaks so many thing in KVM's
implementation that I'd recommend you disable GICv4 until we have a
good solution for that.

	M.

-- 
Without deviation from the norm, progress is not possible.

Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 632817B10B5
	for <lists+linux-kernel@lfdr.de>; Thu, 28 Sep 2023 04:18:32 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229719AbjI1CSb (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Wed, 27 Sep 2023 22:18:31 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:47046 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229437AbjI1CS3 (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Wed, 27 Sep 2023 22:18:29 -0400
Received: from jari.cn (unknown [218.92.28.115])
        by lindbergh.monkeyblade.net (Postfix) with ESMTP id A213EB3;
        Wed, 27 Sep 2023 19:18:27 -0700 (PDT)
Received: from wangkailong$jari.cn ( [182.148.12.64] ) by
 ajax-webmail-localhost.localdomain (Coremail) ; Thu, 28 Sep 2023 10:17:08
 +0800 (GMT+08:00)
X-Originating-IP: [182.148.12.64]
Date:   Thu, 28 Sep 2023 10:17:08 +0800 (GMT+08:00)
X-CM-HeaderCharset: UTF-8
From:   "KaiLong Wang" <wangkailong@jari.cn>
To:     jejb@linux.ibm.com, martin.petersen@oracle.com
Cc:     linux-scsi@vger.kernel.org, linux-kernel@vger.kernel.org
Subject: [PATCH] scsi: lpfc: Clean up errors in lpfc_sli.c
X-Priority: 3
X-Mailer: Coremail Webmail Server Version 2023.1-cmXT6 build
 20230419(ff23bf83) Copyright (c) 2002-2023 www.mailtech.cn
 mispb-4e503810-ca60-4ec8-a188-7102c18937cf-zhkzyfz.cn
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset=UTF-8
MIME-Version: 1.0
Message-ID: <28c39c5b.8a1.18ad9935f63.Coremail.wangkailong@jari.cn>
X-Coremail-Locale: zh_CN
X-CM-TRANSID: AQAAfwDXaD4k4hRliXq+AA--.584W
X-CM-SenderInfo: 5zdqwypdlo00nj6mt2flof0/1tbiAQAJB2T8PZMAAQAbsj
X-Coremail-Antispam: 1Ur529EdanIXcx71UUUUU7IcSsGvfJ3iIAIbVAYjsxI4VWxJw
        CS07vEb4IE77IF4wCS07vE1I0E4x80FVAKz4kxMIAIbVAFxVCaYxvI4VCIwcAKzIAtYxBI
        daVFxhVjvjDU=
X-Spam-Status: No, score=2.2 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_BLOCKED,
        RCVD_IN_PBL,RDNS_NONE,T_SPF_HELO_PERMERROR,T_SPF_PERMERROR,XPRIO
        autolearn=no autolearn_force=no version=3.4.6
X-Spam-Level: **
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Rml4IHRoZSBmb2xsb3dpbmcgZXJyb3JzIHJlcG9ydGVkIGJ5IGNoZWNrcGF0Y2g6CgpFUlJPUjog
ImZvbyAqIGJhciIgc2hvdWxkIGJlICJmb28gKmJhciIKRVJST1I6IHNwYWNlIHJlcXVpcmVkIGJl
Zm9yZSB0aGUgb3BlbiBwYXJlbnRoZXNpcyAnKCcKRVJST1I6IGVsc2Ugc2hvdWxkIGZvbGxvdyBj
bG9zZSBicmFjZSAnfScKRVJST1I6IHNwYWNlIHJlcXVpcmVkIGFmdGVyIHRoYXQgJywnIChjdHg6
VnhWKQpFUlJPUjogImZvbyAqIGJhciIgc2hvdWxkIGJlICJmb28gKmJhciIKRVJST1I6IHNwYWNl
IHByb2hpYml0ZWQgYWZ0ZXIgdGhhdCAnJicgKGN0eDpXeFcpCgpTaWduZWQtb2ZmLWJ5OiBLYWlM
b25nIFdhbmcgPHdhbmdrYWlsb25nQGphcmkuY24+Ci0tLQogZHJpdmVycy9zY3NpL2xwZmMvbHBm
Y19zbGkuYyB8IDQ0ICsrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxl
IGNoYW5nZWQsIDE5IGluc2VydGlvbnMoKyksIDI1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvc2NzaS9scGZjL2xwZmNfc2xpLmMgYi9kcml2ZXJzL3Njc2kvbHBmYy9scGZjX3Ns
aS5jCmluZGV4IDRkZmFkZjI1NGE3Mi4uNjhjOTIyNTUxZmM4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L3Njc2kvbHBmYy9scGZjX3NsaS5jCisrKyBiL2RyaXZlcnMvc2NzaS9scGZjL2xwZmNfc2xpLmMK
QEAgLTkxNiw3ICs5MTYsNyBAQCBzdHJ1Y3QgbHBmY19pb2NicSAqCiBfX2xwZmNfc2xpX2dldF9p
b2NicShzdHJ1Y3QgbHBmY19oYmEgKnBoYmEpCiB7CiAJc3RydWN0IGxpc3RfaGVhZCAqbHBmY19p
b2NiX2xpc3QgPSAmcGhiYS0+bHBmY19pb2NiX2xpc3Q7Ci0Jc3RydWN0IGxwZmNfaW9jYnEgKiBp
b2NicSA9IE5VTEw7CisJc3RydWN0IGxwZmNfaW9jYnEgKmlvY2JxID0gTlVMTDsKIAogCWxvY2tk
ZXBfYXNzZXJ0X2hlbGQoJnBoYmEtPmhiYWxvY2spOwogCkBAIC0xMzQxLDcgKzEzNDEsNyBAQCBf
X2xwZmNfc2xpX2dldF9udm1ldF9zZ2xxKHN0cnVjdCBscGZjX2hiYSAqcGhiYSwgc3RydWN0IGxw
ZmNfaW9jYnEgKnBpb2NicSkKIHN0cnVjdCBscGZjX2lvY2JxICoKIGxwZmNfc2xpX2dldF9pb2Ni
cShzdHJ1Y3QgbHBmY19oYmEgKnBoYmEpCiB7Ci0Jc3RydWN0IGxwZmNfaW9jYnEgKiBpb2NicSA9
IE5VTEw7CisJc3RydWN0IGxwZmNfaW9jYnEgKmlvY2JxID0gTlVMTDsKIAl1bnNpZ25lZCBsb25n
IGlmbGFnczsKIAogCXNwaW5fbG9ja19pcnFzYXZlKCZwaGJhLT5oYmFsb2NrLCBpZmxhZ3MpOwpA
QCAtMjExOCw3ICsyMTE4LDcgQEAgbHBmY19zbGlfbmV4dF9pb3RhZyhzdHJ1Y3QgbHBmY19oYmEg
KnBoYmEsIHN0cnVjdCBscGZjX2lvY2JxICppb2NicSkKIAogCXNwaW5fbG9ja19pcnEoJnBoYmEt
PmhiYWxvY2spOwogCWlvdGFnID0gcHNsaS0+bGFzdF9pb3RhZzsKLQlpZigrK2lvdGFnIDwgcHNs
aS0+aW9jYnFfbG9va3VwX2xlbikgeworCWlmICgrK2lvdGFnIDwgcHNsaS0+aW9jYnFfbG9va3Vw
X2xlbikgewogCQlwc2xpLT5sYXN0X2lvdGFnID0gaW90YWc7CiAJCXBzbGktPmlvY2JxX2xvb2t1
cFtpb3RhZ10gPSBpb2NicTsKIAkJc3Bpbl91bmxvY2tfaXJxKCZwaGJhLT5oYmFsb2NrKTsKQEAg
LTIxMzcsNyArMjEzNyw3IEBAIGxwZmNfc2xpX25leHRfaW90YWcoc3RydWN0IGxwZmNfaGJhICpw
aGJhLCBzdHJ1Y3QgbHBmY19pb2NicSAqaW9jYnEpCiAJCQkJLyogaGlnaGx5IHVucHJvYmFibGUg
Y2FzZSAqLwogCQkJCWtmcmVlKG5ld19hcnIpOwogCQkJCWlvdGFnID0gcHNsaS0+bGFzdF9pb3Rh
ZzsKLQkJCQlpZigrK2lvdGFnIDwgcHNsaS0+aW9jYnFfbG9va3VwX2xlbikgeworCQkJCWlmICgr
K2lvdGFnIDwgcHNsaS0+aW9jYnFfbG9va3VwX2xlbikgewogCQkJCQlwc2xpLT5sYXN0X2lvdGFn
ID0gaW90YWc7CiAJCQkJCXBzbGktPmlvY2JxX2xvb2t1cFtpb3RhZ10gPSBpb2NicTsKIAkJCQkJ
c3Bpbl91bmxvY2tfaXJxKCZwaGJhLT5oYmFsb2NrKTsKQEAgLTMwNzgsOCArMzA3OCw3IEBAIGxw
ZmNfc2xpX2hhbmRsZV9tYl9ldmVudChzdHJ1Y3QgbHBmY19oYmEgKnBoYmEpCiAJCQkJCSh1aW50
MzJfdClwbWJveC0+bWJ4Q29tbWFuZCwKIAkJCQkJcG1ib3gtPnVuLnZhcldvcmRzWzBdLAogCQkJ
CQlwbWJveC0+dW4udmFyV29yZHNbMV0pOwotCQkJfQotCQkJZWxzZSB7CisJCQl9IGVsc2Ugewog
CQkJCWxwZmNfZGVidWdmc19kaXNjX3RyYyhwaGJhLT5wcG9ydCwKIAkJCQkJTFBGQ19ESVNDX1RS
Q19NQk9YLAogCQkJCQkiTUJPWCBjbXBsOiAgICAgICBjbWQ6eCV4IG1iOngleCB4JXgiLApAQCAt
MzE2Myw3ICszMTYyLDcgQEAgbHBmY19zbGlfaGFuZGxlX21iX2V2ZW50KHN0cnVjdCBscGZjX2hi
YSAqcGhiYSkKIAkJCQlwbWJveC0+dW4udmFyV29yZHNbMTBdKTsKIAogCQlpZiAocG1iLT5tYm94
X2NtcGwpCi0JCQlwbWItPm1ib3hfY21wbChwaGJhLHBtYik7CisJCQlwbWItPm1ib3hfY21wbChw
aGJhLCBwbWIpOwogCX0gd2hpbGUgKDEpOwogCXJldHVybiAwOwogfQpAQCAtMzQ0OSw4ICszNDQ4
LDggQEAgc3RhdGljIGludAogbHBmY19zbGlfcHJvY2Vzc191bnNvbF9pb2NiKHN0cnVjdCBscGZj
X2hiYSAqcGhiYSwgc3RydWN0IGxwZmNfc2xpX3JpbmcgKnByaW5nLAogCQkJICAgIHN0cnVjdCBs
cGZjX2lvY2JxICpzYXZlcSkKIHsKLQlJT0NCX3QgICAgICAgICAgICogaXJzcDsKLQlXT1JENSAg
ICAgICAgICAgICogdzVwOworCUlPQ0JfdCAgICAgICAgICAgKmlyc3A7CisJV09SRDUgICAgICAg
ICAgICAqdzVwOwogCWRtYV9hZGRyX3QJIHBhZGRyOwogCXVpbnQzMl90ICAgICAgICAgICBSY3Rs
LCBUeXBlOwogCXN0cnVjdCBscGZjX2lvY2JxICppb2NicTsKQEAgLTkzNjIsNyArOTM2MSw3IEBA
IGxwZmNfc2xpX2lzc3VlX21ib3hfczMoc3RydWN0IGxwZmNfaGJhICpwaGJhLCBMUEZDX01CT1hR
X3QgKnBtYm94LAogCiAJaWYgKHBtYm94LT5tYm94X2NtcGwgJiYgcG1ib3gtPm1ib3hfY21wbCAh
PSBscGZjX3NsaV9kZWZfbWJveF9jbXBsICYmCiAJCXBtYm94LT5tYm94X2NtcGwgIT0gbHBmY19z
bGlfd2FrZV9tYm94X3dhaXQpIHsKLQkJaWYoIXBtYm94LT52cG9ydCkgeworCQlpZiAoIXBtYm94
LT52cG9ydCkgewogCQkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmcGhiYS0+aGJhbG9jaywgZHJ2
cl9mbGFnKTsKIAkJCWxwZmNfcHJpbnRmX2xvZyhwaGJhLCBLRVJOX0VSUiwKIAkJCQkJTE9HX01C
T1ggfCBMT0dfVlBPUlQsCkBAIC05NDY5LDggKzk0NjgsNyBAQCBscGZjX3NsaV9pc3N1ZV9tYm94
X3MzKHN0cnVjdCBscGZjX2hiYSAqcGhiYSwgTFBGQ19NQk9YUV90ICpwbWJveCwKIAkJCQkiTUJP
WCBCc3kgdnBvcnQ6ICBjbWQ6eCV4IG1iOngleCB4JXgiLAogCQkJCSh1aW50MzJfdCltYngtPm1i
eENvbW1hbmQsCiAJCQkJbWJ4LT51bi52YXJXb3Jkc1swXSwgbWJ4LT51bi52YXJXb3Jkc1sxXSk7
Ci0JCX0KLQkJZWxzZSB7CisJCX0gZWxzZSB7CiAJCQlscGZjX2RlYnVnZnNfZGlzY190cmMocGhi
YS0+cHBvcnQsCiAJCQkJTFBGQ19ESVNDX1RSQ19NQk9YLAogCQkJCSJNQk9YIEJzeTogICAgICAg
IGNtZDp4JXggbWI6eCV4IHgleCIsCkBAIC05NTIwLDggKzk1MTgsNyBAQCBscGZjX3NsaV9pc3N1
ZV9tYm94X3MzKHN0cnVjdCBscGZjX2hiYSAqcGhiYSwgTFBGQ19NQk9YUV90ICpwbWJveCwKIAkJ
CQkiTUJPWCBTZW5kIHZwb3J0OiBjbWQ6eCV4IG1iOngleCB4JXgiLAogCQkJCSh1aW50MzJfdClt
YngtPm1ieENvbW1hbmQsCiAJCQkJbWJ4LT51bi52YXJXb3Jkc1swXSwgbWJ4LT51bi52YXJXb3Jk
c1sxXSk7Ci0JCX0KLQkJZWxzZSB7CisJCX0gZWxzZSB7CiAJCQlscGZjX2RlYnVnZnNfZGlzY190
cmMocGhiYS0+cHBvcnQsCiAJCQkJTFBGQ19ESVNDX1RSQ19NQk9YLAogCQkJCSJNQk9YIFNlbmQ6
ICAgICAgIGNtZDp4JXggbWI6eCV4IHgleCIsCkBAIC05NjYwLDcgKzk2NTcsNyBAQCBscGZjX3Ns
aV9pc3N1ZV9tYm94X3MzKHN0cnVjdCBscGZjX2hiYSAqcGhiYSwgTFBGQ19NQk9YUV90ICpwbWJv
eCwKIAkJCQkJdWludDMyX3Qgc2xpbXdvcmQwOwogCQkJCQkvKiBDaGVjayByZWFsIFNMSU0gZm9y
IGFueSBlcnJvcnMgKi8KIAkJCQkJc2xpbXdvcmQwID0gcmVhZGwocGhiYS0+TUJzbGltYWRkcik7
Ci0JCQkJCXNsaW1tYiA9IChNQUlMQk9YX3QgKikgJiBzbGltd29yZDA7CisJCQkJCXNsaW1tYiA9
IChNQUlMQk9YX3QgKikgJnNsaW13b3JkMDsKIAkJCQkJaWYgKCgoc2xpbXdvcmQwICYgT1dOX0NI
SVApICE9IE9XTl9DSElQKQogCQkJCQkgICAgJiYgc2xpbW1iLT5tYnhTdGF0dXMpIHsKIAkJCQkJ
CXBzbGktPnNsaV9mbGFnICY9CkBAIC0xMDM4Miw3ICsxMDM3OSw3IEBAIHN0YXRpYyBzdHJ1Y3Qg
bHBmY19pb2NicSAqCiBscGZjX3NsaV9uZXh0X2lvY2Ioc3RydWN0IGxwZmNfaGJhICpwaGJhLCBz
dHJ1Y3QgbHBmY19zbGlfcmluZyAqcHJpbmcsCiAJCSAgIHN0cnVjdCBscGZjX2lvY2JxICoqcGlv
Y2IpCiB7Ci0Jc3RydWN0IGxwZmNfaW9jYnEgKiBuZXh0aW9jYjsKKwlzdHJ1Y3QgbHBmY19pb2Ni
cSAqbmV4dGlvY2I7CiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZwaGJhLT5oYmFsb2NrKTsKIApA
QCAtMTA2ODUsOCArMTA2ODIsNyBAQCBfX2xwZmNfc2xpX2lzc3VlX2lvY2JfczQoc3RydWN0IGxw
ZmNfaGJhICpwaGJhLCB1aW50MzJfdCByaW5nX251bWJlciwKIAl9IGVsc2UgaWYgKHBpb2NiLT5j
bWRfZmxhZyAmICBMUEZDX0lPX0ZDUCkgewogCQkvKiBUaGVzZSBJTydzIGFscmVhZHkgaGF2ZSBh
biBYUkkgYW5kIGEgbWFwcGVkIHNnbC4gKi8KIAkJc2dscSA9IE5VTEw7Ci0JfQotCWVsc2Ugewor
CX0gZWxzZSB7CiAJCS8qCiAJCSAqIFRoaXMgaXMgYSBjb250aW51YXRpb24gb2YgYSBjb21tYW5k
aSwoQ1gpIHNvIHRoaXMKIAkJICogc2dscSBpcyBvbiB0aGUgYWN0aXZlIGxpc3QKQEAgLTExMzI4
LDcgKzExMzI0LDcgQEAgbHBmY19zbGlfaXNzdWVfaW9jYihzdHJ1Y3QgbHBmY19oYmEgKnBoYmEs
IHVpbnQzMl90IHJpbmdfbnVtYmVyLAogICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2l0aCBu
byBsb2NrIGhlbGQuIFNMSTMgb25seS4KICAqKi8KIHN0YXRpYyBpbnQKLWxwZmNfZXh0cmFfcmlu
Z19zZXR1cCggc3RydWN0IGxwZmNfaGJhICpwaGJhKQorbHBmY19leHRyYV9yaW5nX3NldHVwKHN0
cnVjdCBscGZjX2hiYSAqcGhiYSkKIHsKIAlzdHJ1Y3QgbHBmY19zbGkgKnBzbGk7CiAJc3RydWN0
IGxwZmNfc2xpX3JpbmcgKnByaW5nOwpAQCAtMTE0OTMsOCArMTE0ODksOCBAQCBscGZjX3NsaTRf
YWJ0c19lcnJfaGFuZGxlcihzdHJ1Y3QgbHBmY19oYmEgKnBoYmEsCiAgKiBldmVudCBtZXNzYWdl
IGFuZCBwb3N0cyBldmVudHMgZm9yIHRoZSBtYW5hZ2VtZW50IGFwcGxpY2F0aW9ucy4KICAqKi8K
IHN0YXRpYyB2b2lkCi1scGZjX3NsaV9hc3luY19ldmVudF9oYW5kbGVyKHN0cnVjdCBscGZjX2hi
YSAqIHBoYmEsCi0Jc3RydWN0IGxwZmNfc2xpX3JpbmcgKiBwcmluZywgc3RydWN0IGxwZmNfaW9j
YnEgKiBpb2NicSkKK2xwZmNfc2xpX2FzeW5jX2V2ZW50X2hhbmRsZXIoc3RydWN0IGxwZmNfaGJh
ICpwaGJhLAorCXN0cnVjdCBscGZjX3NsaV9yaW5nICpwcmluZywgc3RydWN0IGxwZmNfaW9jYnEg
KmlvY2JxKQogewogCUlPQ0JfdCAqaWNtZDsKIAl1aW50MTZfdCBldnRfY29kZTsKQEAgLTEzNzEx
LDggKzEzNzA3LDcgQEAgbHBmY19zbGlfc3BfaW50cl9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmRl
dl9pZCkKIAkJCQl3cml0ZWwoY29udHJvbCwgcGhiYS0+SENyZWdhZGRyKTsKIAkJCQlyZWFkbChw
aGJhLT5IQ3JlZ2FkZHIpOyAvKiBmbHVzaCAqLwogCQkJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
JnBoYmEtPmhiYWxvY2ssIGlmbGFnKTsKLQkJCX0KLQkJCWVsc2UKKwkJCX0gZWxzZQogCQkJCXdv
cmtfaGFfY29weSAmPSB+SEFfTEFUVDsKIAkJfQogCkBAIC0xMzc0Niw4ICsxMzc0MSw3IEBAIGxw
ZmNfc2xpX3NwX2ludHJfaGFuZGxlcihpbnQgaXJxLCB2b2lkICpkZXZfaWQpCiAJCQkJCSAgICB+
KEhDX1IwSU5UX0VOQSA8PCBMUEZDX0VMU19SSU5HKTsKIAkJCQkJd3JpdGVsKGNvbnRyb2wsIHBo
YmEtPkhDcmVnYWRkcik7CiAJCQkJCXJlYWRsKHBoYmEtPkhDcmVnYWRkcik7IC8qIGZsdXNoICov
Ci0JCQkJfQotCQkJCWVsc2UgeworCQkJCX0gZWxzZSB7CiAJCQkJCWxwZmNfZGVidWdmc19zbG93
X3JpbmdfdHJjKHBoYmEsCiAJCQkJCQkiSVNSIHNsb3cgcmluZzogICBwd29yazoiCiAJCQkJCQki
eCV4IGhhd29yazp4JXggd2FpdDp4JXgiLAotLSAKMi4xNy4xCg==

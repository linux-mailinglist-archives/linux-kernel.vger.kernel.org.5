Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id EB35D7F2E8B
	for <lists+linux-kernel@lfdr.de>; Tue, 21 Nov 2023 14:40:47 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S234380AbjKUNks (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 21 Nov 2023 08:40:48 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:57818 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S234273AbjKUNki (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 21 Nov 2023 08:40:38 -0500
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id E020CD6A
        for <linux-kernel@vger.kernel.org>; Tue, 21 Nov 2023 05:40:34 -0800 (PST)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 87374C433CC;
        Tue, 21 Nov 2023 13:40:34 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1700574034;
        bh=SzEJSARPBu356MnqKuppWjOHsICMADRQevq4Qbw7fLE=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=OLRQMdk1ttntlk5HgMqe1X6VIwSYnAkEzWqHWW0Ity5Z4JPORqmgTl99QXcoKLiQu
         +fZ+ZZJogC4pTjB4S6Mb1EMw+cVSNL3gMowOB1pzr19jcuA00B2zx3sJdtYrKUxiCI
         M5h0d8oLdwnFKckUondaPNxJhBK8uR8oNIoz0DS5VcWCsk2tOmYyUrDLDE2HW+bbVx
         9eRalFATDp4mqlEPIX1eFfGGy4KRmIrJ0+XDhNT1hecYgsMZdIVrG6ojUy6yV5u5T6
         8ONldjRV9AgPDwm0OQMPZnqMStqDT+LS3sNfS2X/vMcO009u1VJyo8CkcN0SSmCLju
         th5iBaTWQ0T4Q==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1r5QzQ-00F5sJ-3K;
        Tue, 21 Nov 2023 13:40:32 +0000
Date:   Tue, 21 Nov 2023 13:40:31 +0000
Message-ID: <86pm03z0kw.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Hector Martin <marcan@marcan.st>,
        Arnaldo Carvalho de Melo <acme@redhat.com>,
        Ian Rogers <irogers@google.com>,
        James Clark <james.clark@arm.com>
Cc:     linux-perf-users@vger.kernel.org,
        LKML <linux-kernel@vger.kernel.org>,
        Asahi Linux <asahi@lists.linux.dev>,
        Mark Rutland <mark.rutland@arm.com>
Subject: Re: [REGRESSION] Perf (userspace) broken on big.LITTLE systems since v6.5
In-Reply-To: <08f1f185-e259-4014-9ca4-6411d5c1bc65@marcan.st>
References: <08f1f185-e259-4014-9ca4-6411d5c1bc65@marcan.st>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/29.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: marcan@marcan.st, acme@redhat.com, irogers@google.com, james.clark@arm.com, linux-perf-users@vger.kernel.org, linux-kernel@vger.kernel.org, asahi@lists.linux.dev, mark.rutland@arm.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-4.4 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_MED,
        SPF_HELO_NONE,SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=ham
        autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

[Adding key people on Cc]

On Tue, 21 Nov 2023 12:08:48 +0000,
Hector Martin <marcan@marcan.st> wrote:
> 
> Perf broke on all Apple ARM64 systems (tested almost everything), and
> according to maz also on Juno (so, probably all big.LITTLE) since v6.5.

I can confirm that at least on 6.7-rc2, perf is pretty busted on any
asymmetric ARM platform. It isn't clear what criteria is used to pick
the PMU, but nothing works anymore.

The saving grace in my case is that Debian still ships a 6.1 perftool
package, but that's obviously not going to last.

I'm happy to test potential fixes.

	M.

-- 
Without deviation from the norm, progress is not possible.

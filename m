Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id AD81D77D1B0
	for <lists+linux-kernel@lfdr.de>; Tue, 15 Aug 2023 20:24:36 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S239052AbjHOSYF (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 15 Aug 2023 14:24:05 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:49122 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S239055AbjHOSXu (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 15 Aug 2023 14:23:50 -0400
Received: from ms.lwn.net (ms.lwn.net [45.79.88.28])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id E3BB819AF;
        Tue, 15 Aug 2023 11:23:49 -0700 (PDT)
Received: from localhost (unknown [IPv6:2601:281:8300:73::5f6])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by ms.lwn.net (Postfix) with ESMTPSA id A15F82ED;
        Tue, 15 Aug 2023 18:23:48 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 ms.lwn.net A15F82ED
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=lwn.net; s=20201203;
        t=1692123828; bh=/WDM2geFXvPyxkbFTUNOqG5i2x2y+X35CYU2z5xHmqM=;
        h=From:To:Cc:Subject:In-Reply-To:References:Date:From;
        b=d6omHjT+TcpM0athcXjpHp2g+IsGhtmvETdogzrMyH2vhTR82BaS69oege5OcKx2O
         Ko5g37wava/y/+EaEUza+oEanEn/8FAfiMgoMecDuz4NpyL2Ah9Y298J/fNVnWkTxu
         BIkyxTKgmkHTuTVDyj9UZ7s6fKvQJWCaAjZAjHTgvl0WzTATpomaJrO/MiAE2cbwl1
         j8OMYDvrBsW0jn4j1wZVpKGG0NPhsCaqr6WdxOiKlerBuXCwaAMRE8hrb2K7peJCQy
         jjCcMeCu9q8eUnE6SR14DhlZYpBwQamr/NOyMJV3ceS1bfGOPNNRYfldm6psDkkMo3
         7FzoFpb4WSscQ==
From:   Jonathan Corbet <corbet@lwn.net>
To:     Carlos Bilbao <carlos.bilbao@amd.com>,
        "linux-doc@vger.kernel.org" <linux-doc@vger.kernel.org>,
        Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Cc:     Avadhut Naik <Avadhut.Naik@amd.com>,
        Miguel Ojeda <ojeda@kernel.org>,
        Akira Yokosawa <akiyks@gmail.com>
Subject: Re: [RFC] Proposal to relax warnings of htmldocs
In-Reply-To: <85964510-4f88-58d2-2687-f7fa76013cf9@amd.com>
References: <85964510-4f88-58d2-2687-f7fa76013cf9@amd.com>
Date:   Tue, 15 Aug 2023 12:23:47 -0600
Message-ID: <87v8dgtb9o.fsf@meer.lwn.net>
MIME-Version: 1.0
Content-Type: text/plain
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
        SPF_HELO_NONE,SPF_PASS,URIBL_BLOCKED autolearn=ham autolearn_force=no
        version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Carlos Bilbao <carlos.bilbao@amd.com> writes:

> Hello all,
>
> I would like to discuss a recurring issue that we all have encountered
> while running `make htmldocs`. The process often generates an overwhelming
> amount of warnings that are not relevant to our work, which makes it harder
> to identify and address actual warning messages related to our changes.
>
> One of the reasons for this is the variation in warnings raised by
> different compilers. For instance, the Linux kernel robot employs Sparse,
> which recently raised a warning that we (Avadhut in CC, and then me
> reviewing his patch) did not catch during our testing [1,2].
>
> Particularly annoying -to me personally- are warnings of the form:
>
> "warning: Function parameter or member 'field' not described in 'struct'"
>
> that seem to enumerate every single undocumented field within a struct.
>
> I would like to propose something to alleviate this issue before the list
> of warnings keeps piling up.

...other than fixing the actual problems? :)

> I suggest for the command `make htmldocs` to
> only display, by default, warnings directly related to the changes being
> made, unless explicitly requested otherwisee.
>
> I'm thinking we could do this, for example, by making hmtldocs a two-step
> process: First running htmldocs as usual but with warnings disabled, and
> then generating docs again but only for the new files (see $git diff
> --name-only HEAD), with warnings active but limited to the scope of the
> changes made.

A normal build should just generate warnings for files that have
changed (since the last build).  Does that not do what you want?

Trying to get Sphinx to do smarter things with partial builds seems like
a path to frustration.  Since the specific warnings you're talking about
are generated by kernel-doc, a better solution would probably just
invoke it directly.  It wouldn't be that hard to bash out a script to
feed a given set of files to kernel-doc and see what it says.

As an alternative, of course, we could consider turning off those
specific warnings entirely for normal builds.

Thanks,

jon

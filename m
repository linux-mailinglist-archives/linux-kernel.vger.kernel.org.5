Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 14E477CF0DB
	for <lists+linux-kernel@lfdr.de>; Thu, 19 Oct 2023 09:15:17 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1344754AbjJSHPP (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Thu, 19 Oct 2023 03:15:15 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:56424 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S232788AbjJSHPO (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 19 Oct 2023 03:15:14 -0400
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 54707123
        for <linux-kernel@vger.kernel.org>; Thu, 19 Oct 2023 00:15:11 -0700 (PDT)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id DFD80C433C8;
        Thu, 19 Oct 2023 07:15:10 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=k20201202; t=1697699710;
        bh=PP+R+qu15Zi7YrcYi4QBuD0RQDJPomxczNjindxBJl0=;
        h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
        b=WF2pwdCDgI3gvtTSRP8HuWN9guaMoGi7Izl/UdFp2Bee6hL+IlQ2qVl9J7cm7AgRP
         SJlYSSQY0ArpznUWCxPEUXbTXpdls8pXdGAMIRHFgUwbDsPLndahZyNIYnVce1FuQa
         CXkivjrwhYsqvp0a8A6bB0b4Xa/V4/dqq1aAX+XuN66bkic/0qgFx4mofa9HQv1acp
         kByR6B84yzrWjrG+RwMLWUPBxRyMkdBGEYpSDK4Q9LbTYNW9TiodIQZvKBNqrMUcjL
         FzIcPD4/5iV9MVB7DE4dRUds9oq8QpW+picabntLxigwYVmBKpJ8g2oBiKnUo7CnCU
         6qWDFEfYhmq1A==
Received: from ip-185-104-136-29.ptr.icomera.net ([185.104.136.29] helo=wait-a-minute.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.95)
        (envelope-from <maz@kernel.org>)
        id 1qtNFM-005eAG-1Y;
        Thu, 19 Oct 2023 08:15:08 +0100
Date:   Thu, 19 Oct 2023 08:15:03 +0100
Message-ID: <8734y76q2w.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Anshuman Khandual <anshuman.khandual@arm.com>
Cc:     linux-arm-kernel@lists.infradead.org,
        Catalin Marinas <catalin.marinas@arm.com>,
        Will Deacon <will@kernel.org>,
        Oliver Upton <oliver.upton@linux.dev>,
        linux-kernel@vger.kernel.org
Subject: Re: [PATCH] arm64: Independently update HDFGRTR_EL2 and HDFGWTR_EL2
In-Reply-To: <d8db313d-1161-4a6e-9edc-7dc1e22d2018@arm.com>
References: <20231018030007.1968317-1-anshuman.khandual@arm.com>
        <86r0lsm7cq.wl-maz@kernel.org>
        <d8db313d-1161-4a6e-9edc-7dc1e22d2018@arm.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/28.2
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.104.136.29
X-SA-Exim-Rcpt-To: anshuman.khandual@arm.com, linux-arm-kernel@lists.infradead.org, catalin.marinas@arm.com, will@kernel.org, oliver.upton@linux.dev, linux-kernel@vger.kernel.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
X-Spam-Status: No, score=-4.4 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
        DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_MED,
        SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, 19 Oct 2023 04:36:15 +0100,
Anshuman Khandual <anshuman.khandual@arm.com> wrote:
> 
> 
> 
> On 10/18/23 18:10, Marc Zyngier wrote:
> > On Wed, 18 Oct 2023 04:00:07 +0100,
> > Anshuman Khandual <anshuman.khandual@arm.com> wrote:
> >>
> >> Currently PMSNEVFR_EL1 system register read, and write access EL2 traps are
> >> disabled, via setting the same bit (i.e 62) in HDFGRTR_EL2, and HDFGWTR_EL2
> >> respectively. Although very similar, bit fields are not exact same in these
> >> two EL2 trap configure registers particularly when it comes to read-only or
> >> write-only accesses such as ready-only 'HDFGRTR_EL2.nBRBIDR' which needs to
> >> be set while enabling BRBE on NVHE platforms. Using the exact same bit mask
> >> fields for both these trap register risk writing into their RESERVED areas,
> >> which is undesirable.
> > 
> > Sorry, I don't understand at all what you are describing. You seem to
> > imply that the read and write effects of the FGT doesn't apply the
> > same way. But my reading of the ARM ARM is that  behave completely
> > symmetrically.
> > 
> > Also, what is nBRBIDR doing here? It is still set to 0. What
> > 'RESERVED' state are you talking about?
> 
> Let's observe the following example which includes the nBRBIDR problem,
> mentioned earlier.
> 
> Read access trap configure
> 
> HDFGRTR_EL2[59]	   - nBRBIDR
> HDFGRTR_EL2[58]	   - PMCEIDn_EL0
> 
> Write access trap configure
> 
> HDFGWTR_EL2[59:58] - RES0
> 
> Because BRBIDR_EL1 and PMCEID<N>_EL0 are read only registers they don't
> have corresponding entries in HDFGWTR_EL2 for write trap configuration.
> 
> Using the exact same value contained in 'x0' both for HDFGRTR_EL2, and
> HDFGWTR_EL2 will be problematic in case it contains bit fields that are
> available only in one of the registers but not in the other.
> 
> If 'x0' contains nBRBIDR being set, it will be okay for HDFGRTR_EL2 but
> might not be okay for HDFGWTR_EL2 where it will get into RESERVED areas.

None of which matters for this patch. You keep arguing about something
that does not exist in the change you're proposing.

[...]

> I should have given more details in the commit message but hope
> you have some context now, but please do let me know if there
> is something still missing.

What is missing is a useful patch. This one just obfuscates things for
no particular purpose. If you have a useful change to contribute,
please send that instead (your BRBE change). We don't need an extra,
standalone and pointless patch such as this one.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.

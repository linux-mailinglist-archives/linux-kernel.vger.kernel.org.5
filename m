Return-Path: <linux-kernel+bounces-89430-lists+linux-kernel=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from ny.mirrors.kernel.org (ny.mirrors.kernel.org [147.75.199.223])
	by mail.lfdr.de (Postfix) with ESMTPS id CE1FC86F041
	for <lists+linux-kernel@lfdr.de>; Sat,  2 Mar 2024 12:31:02 +0100 (CET)
Received: from smtp.subspace.kernel.org (wormhole.subspace.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by ny.mirrors.kernel.org (Postfix) with ESMTPS id A84EB1C2154E
	for <lists+linux-kernel@lfdr.de>; Sat,  2 Mar 2024 11:31:01 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 49947171A5;
	Sat,  2 Mar 2024 11:30:55 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="dA3hpWMg"
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 8CECF323C;
	Sat,  2 Mar 2024 11:30:54 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1709379054; cv=none; b=X8eecy4sOpFzFiaVA5LzntNlzOJck+S1bxR6Ozer991d3W3y/wtR3vqrqlPMC9LUIj99qrbwF4j81sGzaoyj3/KagSJEXTBnFU3MGhcZBge0RvXGjqKrcK+8B6QxmQYcxBvgBpCCryMAgZnootBHZOfGBEFMMvz6SoiYkXhvz0g=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1709379054; c=relaxed/simple;
	bh=oQ+DxDSSOmlUj3fhF7GDj4r02Xb+mjiohzUCcRJFJ0o=;
	h=Date:Message-ID:From:To:Cc:Subject:In-Reply-To:References:
	 MIME-Version:Content-Type; b=rPJKkFLD3uW06+DEn5Q5jsI0qKunyZJnWlG0gz7WlYZXkMNH6FRxf3xw7klIxIwVsS5gotaV7897Hk/xt7bbsvtcVVNNcbwsmAgcV9dRXfY/ta7hJGj5nRMRwp1am8bP+YibCmwSRh6Lfjd6IZMt0YZDgZpAwj4kK6npP5rjBXc=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=dA3hpWMg; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 10A5BC433F1;
	Sat,  2 Mar 2024 11:30:54 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1709379054;
	bh=oQ+DxDSSOmlUj3fhF7GDj4r02Xb+mjiohzUCcRJFJ0o=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=dA3hpWMg0saKPgHbbyBZk8IzLnWTeqRvXU2aavzMLNQhEI8vCOPq7RpquUVLzeEXz
	 Tzb7JMHSlJAQg5CNV0nt4UPRp6TxKehG8xIQc/MlWQ/z9+b59DtNZsJ31jch/Hu6fI
	 pMxoT4mgbRXyks/Ywzh2zCvD1KgtnxjCz/0u730Jr+0ICIMW4ILAPPU/1O2JZsG1Ea
	 z2aqCOkDWskh0R36Vm6UhEQrWmlvkfNrFt+DH9x0mMcMzNicKn5JXU2hOsr3Stiqta
	 X+QGi8/YeQ6xtRm4S5kQQzcwpVLTlchcb2AMoL97fd+x6U8I5lX3b7h6XR85mG/h93
	 MJkenmFOogbRQ==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.95)
	(envelope-from <maz@kernel.org>)
	id 1rgNZr-008lX5-Rm;
	Sat, 02 Mar 2024 11:30:51 +0000
Date: Sat, 02 Mar 2024 11:30:51 +0000
Message-ID: <86y1b027mc.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Mark Brown <broonie@kernel.org>
Cc: Oliver Upton <oliver.upton@linux.dev>,
	James Morse <james.morse@arm.com>,
	Suzuki K Poulose <suzuki.poulose@arm.com>,
	Catalin Marinas <catalin.marinas@arm.com>,
	Will Deacon <will@kernel.org>,
	linux-arm-kernel@lists.infradead.org,
	kvmarm@lists.linux.dev,
	linux-kernel@vger.kernel.org
Subject: Re: [PATCH v2 2/2] KVM: arm64: Reuse struct cpu_fp_state to track the guest FP state
In-Reply-To: <20240229-kvm-arm64-group-fp-data-v2-2-276de0d550e8@kernel.org>
References: <20240229-kvm-arm64-group-fp-data-v2-0-276de0d550e8@kernel.org>
	<20240229-kvm-arm64-group-fp-data-v2-2-276de0d550e8@kernel.org>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/29.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: broonie@kernel.org, oliver.upton@linux.dev, james.morse@arm.com, suzuki.poulose@arm.com, catalin.marinas@arm.com, will@kernel.org, linux-arm-kernel@lists.infradead.org, kvmarm@lists.linux.dev, linux-kernel@vger.kernel.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

On Thu, 29 Feb 2024 21:47:35 +0000,
Mark Brown <broonie@kernel.org> wrote:
> 
> At present we store the various bits of floating point state individually
> in struct kvm_vcpu_arch and construct a struct cpu_fp_state to share with
> the host each time we exit the guest. Let's simplify this a little by
> having a struct cpu_fp_state in the struct kvm_vcpu_arch and initialising
> this while initialising the guest.

This structure is only useful to the physical CPU we run on, and does
not capture anything that is related to the guest state. Why should it
live in the vcpu structure, duplicating things we already have?

This is just making things even more opaque.

If you need to add such a structure so that you can know what to
save/restore on context switch, then attach it to the per-CPU data
structure we already have.

	M.

-- 
Without deviation from the norm, progress is not possible.

